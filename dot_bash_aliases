# vim: filetype=bash

# Note: Run '\command' to run the command that it shadowed by an alias.

# ==============================================================================
# Reserved (configured elsewhere)
# ==============================================================================
# cz (.bashrc)
# czw (.bashrc)
# czp (.bashrc)

# ==============================================================================
# Config
# ==============================================================================
alias edit='vim ~/.bash_aliases'
alias edit-alias='vim ~/.bash_aliases'
alias edit-bashrc='vim ~/.bashrc'

# ==============================================================================
# Default Replacements
# ==============================================================================
alias ls='lsd'
alias vim='nvim'
alias lvim='nvim -u NONE --noplugin -n'
alias lv='lvim'
alias viml='nvim -u NONE --noplugin -n'
alias vl='viml'
alias diff='delta'

# ==============================================================================
# Single letter aliases.
# ==============================================================================
function _o() {
  local target="${1:-.}"
  eval nohup xdg-open "$target" >/dev/null 2>&1 & disown
}

#alias a='TODO'
alias b='cd ..'
alias c='clear'
alias d='docker'
alias e='sudoedit'
alias f='fg'
alias g='git'
alias h='cd $HOME'
alias i='ipconfig getifaddr en0'
alias j='jobs'
#alias k='TODO'
alias l='ls -alF'
alias m='man'
#alias n='TODO'
alias o='_o'
alias p='pushd'
alias q='popd'
alias r='src' # reload
alias s='sudo'
alias t='tmux'
alias tt='TMUX= tmux'
alias u='sudo -i'
alias v='vim'
alias ve='nvim --cmd "lua vim.g.read_from_stdin=1" +startinsert'
alias vv='vim .'
#alias w='TODO'
alias x='exit'
alias y='yz'
#alias z='TODO'

# ==============================================================================
# Safety Features.
# ==============================================================================
alias cp='cp -i'	# Prompt for overwrite.
alias mv='mv -i'	# Prompt for overwrite.
alias rm='rm -I'	# Prompt for >3 or recursive deletion.
alias ln='ln -i'	# Promt for overwrite.
alias chown='chown --preserve-root'
alias chmod='chmod --preserve-root'
alias chgrp='chgrp --preserve-root'

# ==============================================================================
# Error Tolerance.
# ==============================================================================
alias cd..='cd ..'

# ==============================================================================
# Custom Script Aliases
# ==============================================================================
alias tlr="tl --resume"

# ==============================================================================
# Misc Aliases
# ==============================================================================
alias ai="claude --dangerously-skip-permissions"
alias aid="claude --dangerously-skip-permissions --plugin-dir ~/git/agent-toolkit/ --plugin-dir ~/git/system-agent/"
alias aiq="claude"
alias also="function _also() { eval nohup "$@" & disown; }"
alias src="source ~/.bashrc"
alias uuid="cat /proc/sys/kernel/random/uuid | tr -d '\n' | tee >(xclip); echo ''"
alias hs="history -r"
alias hst="history -r"
alias fix="reset && stty sane && tput rs1"
alias lh="grep -P \"^Host ([^*]+)$\" $HOME/.ssh/config | sed 's/Host //'"
alias lg='lazygit'
alias lgc='GIT_DIR=$HOME/.cfg GIT_WORK_TREE=$HOME lazygit'
alias epoch="date +%s"
alias phpdoc="phpDocumentor.phar"
alias phpdocs="phpDocumentor.phar"
alias password="tr -dc a-z2-9 </dev/urandom | head -c 16 ; echo ''"
alias password1="tr -dc a-zA-Z1-9 </dev/urandom | head -c 32 ; echo ''"
alias password2="tr -dc 'A-Za-z0-9!#$%&()*+,-./:;<=>?@[\]^_{|}~' </dev/urandom | head -c 64  ; echo ''"
alias pw="password"
alias pw1="password1"
alias pw2="password2"
alias nlogtail="tail -f /tmp/neovim.log"
alias nloglcear="echo '' > /tmp/neovim.log"
alias sshconfig="vim ~/.ssh/config"
alias setscreen="export TERM=screen-256color"
alias today='
day=$(date +%-d)

# Handle special cases 11, 12, and 13
if [[ $day -eq 11 || $day -eq 12 || $day -eq 13 ]]; then
  suffix="th"
else
  # Determine suffix by the last digit
  case $((day % 10)) in
    1) suffix="st" ;;
    2) suffix="nd" ;;
    3) suffix="rd" ;;
    *) suffix="th" ;;
  esac
fi

formatted_date="$(date +"%A $day$suffix %B %Y")"

# Print to terminal (with a newline)
echo "$formatted_date"

# Copy to clipboard without the trailing newline
echo -n "$formatted_date" | xclip -selection clipboard
'

alias tomorrow='
day=$(date -d "tomorrow" +%-d)

# Handle special cases 11, 12, and 13
if [[ $day -eq 11 || $day -eq 12 || $day -eq 13 ]]; then
  suffix="th"
else
  # Determine suffix by the last digit
  case $((day % 10)) in
    1) suffix="st" ;;
    2) suffix="nd" ;;
    3) suffix="rd" ;;
    *) suffix="th" ;;
  esac
fi

formatted_date="$(date -d "tomorrow" +"%A $day$suffix %B %Y")"

# Print to terminal (with a newline)
echo "$formatted_date"

# Copy to clipboard without the trailing newline
echo -n "$formatted_date" | xclip -selection clipboard
'

alias nextbiz='
# Get day of week (1=Mon, 7=Sun)
dow=$(date +%u)

# Calculate days until next business day
if [ "$dow" -eq 5 ]; then
  offset=3  # Friday -> Monday
elif [ "$dow" -eq 6 ]; then
  offset=2  # Saturday -> Monday
elif [ "$dow" -eq 7 ]; then
  offset=1  # Sunday -> Monday
else
  offset=1  # Mon-Thu -> next day
fi

day=$(date -d "+$offset days" +%-d)

# Handle special cases 11, 12, and 13
if [[ $day -eq 11 || $day -eq 12 || $day -eq 13 ]]; then
  suffix="th"
else
  # Determine suffix by the last digit
  case $((day % 10)) in
    1) suffix="st" ;;
    2) suffix="nd" ;;
    3) suffix="rd" ;;
    *) suffix="th" ;;
  esac
fi

formatted_date="$(date -d "+$offset days" +"%A $day$suffix %B %Y")"

# Print to terminal (with a newline)
echo "$formatted_date"

# Copy to clipboard without the trailing newline
echo -n "$formatted_date" | xclip -selection clipboard
'

alias week='
get_suffix() {
  d=$1
  if [[ $d -eq 11 || $d -eq 12 || $d -eq 13 ]]; then
    echo "th"
  else
    case $((d % 10)) in
      1) echo "st" ;;
      2) echo "nd" ;;
      3) echo "rd" ;;
      *) echo "th" ;;
    esac
  fi
}

output=$(
  for i in {0..6}; do
    day=$(date -d "monday +$i day" +%-d)
    suffix=$(get_suffix "$day")
    formatted=$(date -d "monday +$i day" +"%A $day$suffix %B %Y")

    if [ "$i" -lt 6 ]; then
      # Date + blank line after it
      printf "%s\n\n" "$formatted"
    else
      # Last date: no trailing newline
      printf "%s" "$formatted"
    fi
  done
)

# Print to terminal with a newline at the end
printf "%s\n" "$output"

# Copy to clipboard without adding an extra newline
printf "%s" "$output" | xclip -selection clipboard
'


timestamp() {
    date_part=$(date +%Y_%m_%d)
    time_part=$(date +%s | tail -c 7)
    echo "${date_part}_${time_part}"
}

# Python
alias venv-here="python3 -m venv venv; source venv/bin/activate"
alias py="python"
alias pyy="python2"
alias pyyy="python3"
alias venv='function _venv_activate() { \
  local target="${1:-.}/venv"; \
  if [ -d "$target" ]; then \
    source "$target/bin/activate"; \
  else \
    echo "No virtual environment found at $target"; \
  fi; \
}; _venv_activate'

# ------------------------------------------------------------------------------
# Tests
# source: https://github.com/termstandard/colors
alias testtruecolor='awk '"'"'BEGIN{
    s="/\\/\\/\\/\\/\\"; s=s s s s s s s s;
    for (colnum = 0; colnum<77; colnum++) {
        r = 255-(colnum*255/76);
        g = (colnum*510/76);
        b = (colnum*255/76);
        if (g>255) g = 510-g;
        printf "\033[48;2;%d;%d;%dm", r,g,b;
        printf "\033[38;2;%d;%d;%dm", 255-r,255-g,255-b;
        printf "%s\033[0m", substr(s,colnum+1,1);
    }
    printf "\n";
}'"'"''

alias testlig='echo "-> <- ==> === != !== && || ::"'

# ==============================================================================
# Script Aliases
# ==============================================================================
alias dsl="~/.screenlayout/displaylink.sh"
alias dsd="~/.screenlayout/default.sh"
alias dsh="~/.screenlayout/home.sh"
alias dsw="~/.screenlayout/work.sh"

# ==============================================================================
# Program Aliases
# ==============================================================================
alias codex='codex --sandbox danger-full-access'

# ------------------------------------------------------------------------------
# cd Aliases.
alias ..='cd ..'
alias ..1='cd ..'
alias ..2='cd ../..'
alias ..3='cd ../../..'
alias ..4='cd ../../../..'
alias ..5='cd ../../../../..'

alias cdg='cd ~/git/'
alias cdgx='cd ~/gitx/'
alias cdf='cd ~/file/'
alias cds='cd ~/scratch/'
alias cdsql='cd ~/sql-dump/'
alias cdb='cd ~/bin/'
alias cdssh='cd ~/.ssh/'
alias cdt='cd ~/tmp/'
alias cdc='cd ~/.config/'
alias cdd='cd ~/Downloads/'
alias cdbak='cd ~/bak/'

# Alias to allow cding to a files parent 
cdp() {
  if [ -f "$1" ]; then
    cd "$(dirname "$1")"
  else
    cd "$1"
  fi
}

# ------------------------------------------------------------------------------
# grep Aliases
alias grep='grep --color=auto'
alias fgrep='fregp --color=auto'
alias egrep='egrep --color=auto'
alias grephist='history | grep'	# Requires argument. Search history.
alias greppros='ps -Af | grep'  # Requires argument. Search process list.

# ------------------------------------------------------------------------------
# ls default Aliases.
alias ls='ls -hF --color=auto'	# Follow symlink, dont sort.
alias la='ls -A'		# All.
alias lr='ls -R' 		# Recursive ls.
alias ll='ls -alF'
# Requires above alias.
alias lx='ll -BX'		# Sort by extension.
alias lz='ll -rS'		# Sort by size.
alias lt='ll -rt'		# Sort by date.
# ls to lsd conditional aliases.
if command -v lsd &> /dev/null
then
	alias ls='lsd -hF --color=auto'	# Follow symlink, dont sort.
	alias la='lsd -A'		# All.
	alias lr='lsd -R' 		# Recursive ls.
	alias ll='lsd -alF'
	# Requires above alias.
	alias lx='ll -BX'		# Sort by extension.
	alias lz='ll -rS'		# Sort by size.
	alias lt='ll -rt'		# Sort by date.
fi

# ------------------------------------------------------------------------------
# Ping Aliases (:ping)
alias ping='ping -c 5'

# ------------------------------------------------------------------------------
# Composer 1 Aliases
alias composer1="php ~/bin/composer1.phar"
alias composerone="php ~/bin/composer1.phar"
alias ci="composer install"
alias cmi="php -d memory_limit=-1 ~/bin/composer1.phar install"
alias cmu="php -d memory_limit=-1 ~/bin/composer1.phar update"
alias cmr="php -d memory_limit=-1 ~/bin/composer1.phar require"

# ------------------------------------------------------------------------------
# Composer 2 Aliases (:c2)
alias c2mi="php -d memory_limit=-1 ~/bin/composer.phar install"
alias c2mu="php -d memory_limit=-1 ~/bin/composer.phar update"
alias c2mr="php -d memory_limit=-1 ~/bin/composer.phar require"

# ------------------------------------------------------------------------------
# Ngrok Aliases (:ngr)
alias ngr="ngrok http localhost:8000"

# ------------------------------------------------------------------------------
# NPM Aliases (:npm)
alias npmi="npm install"
alias npmrw="npm run watch"

# ------------------------------------------------------------------------------
# PHP Artisan Aliases (:pa)
alias pac="php artisan cache:clear; php artisan route:clear; php artisan view:clear; php artisan config:clear"
alias pacs="pac; php artisan serve"
alias pacac="php artisan cache:clear"
alias pacc="php artisan config:clear"
alias pakg="php artisan key:generate"
alias pam="php artisan migrate"
alias pamf="php artisan migrate:fresh"
alias pamfs="php artisan migrate:fresh --seed"
alias pamr="php artisan migrate:rollback"
alias paq="php artisan queue:listen"
alias paqq="function _paqq() { eval php aritsan queue:listen --queue=$1; }"
alias paqw="php artisan queue:work"
alias parc="php artisan route clear"
alias parl="php artisan route:list"
alias pas="php artisan serve"
alias pat="php artisan tinker"
alias padbs="php artisan db:seed"
alias tinker="php artisan tinker"
alias sch="watch -n 60 php artisan schedule:run"
alias sch5="watch -n 5 php artisan schedule:run"
alias sch15="watch -n 15 php artisan schedule:run"
alias sch30="watch -n 30 php artisan schedule:run"

# ------------------------------------------------------------------------------
# Tmux Aliases (:t)
alias ta="t attach"
alias tks="t kill-session -t "
#
# ------------------------------------------------------------------------------
# Tmuxp Aliases (:tp)
alias tp="tmuxp load"
alias tptp="tmuxp load tmuxp"

# ------------------------------------------------------------------------------
# OpenTofu / Terraform Aliases
alias terraform="tofu"
alias tfi="tofu init"
alias tfiu="tofu init -upgrade"
alias tf="tofu"
alias tfp="tofu plan"
alias tfa="tofu apply"
alias tfaaa="tofu apply -auto-approve"
alias tfi="tofu init"
alias tfv="tofu validate"
alias tfv="tofu refresh"

# ------------------------------------------------------------------------------
# Vagrant Aliases (:vg)
alias vg="vagrant"
alias vgssh="vagrant ssh"
alias vgup="vagrant up"
alias vghalt="vagrant halt"

# ------------------------------------------------------------------------------
# Docker Aliases
alias dpsl="docker ps | less -S"

# ------------------------------------------------------------------------------
# Docker Compose Aliases
alias dc="docker compose"
alias dcu="docker compose up -d && docker compose logs -f"
alias dcd="docker compose down"
alias dcf="docker compose logs -f"
alias dcp="docker compose pull"
alias dcsh="docker compose exec php bash"

# ------------------------------------------------------------------------------
# Yazi Aliases
alias yz='yazi --cwd-file=$HOME/.yazidir; YAZILASTDIR=$(cat $HOME/.yazidir); cd "$YAZILASTDIR"'
alias yy='yazi --cwd-file=$HOME/.yazidir; YAZILASTDIR=$(cat $HOME/.yazidir)'
alias ycd='YAZILASTDIR=$(cat $HOME/.yazidir); cd "$YAZILASTDIR"'

# ------------------------------------------------------------------------------
# ShellGPT Aliases
alias sg="sgpt"
alias sgs="sgpt --shell"
alias sgc="sgpt --code"
alias sgch="sgpt --code"
alias sgr="sgpt --repl"
alias sgl="sgpt --list-chats"

# ------------------------------------------------------------------------------
# Aider

# Eval
# alias o3mini="source ~/git/aider/venv/bin/activate; aider --no-attribute-author --no-attribute-committer --multiline --no-gitignore --no-suggest-shell-commands --vim --watch --no-auto-commit --model o3-mini"
# alias o3mini-low="source ~/git/aider/venv/bin/activate; aider --no-attribute-author --no-attribute-committer --multiline --no-gitignore --no-suggest-shell-commands --vim --watch --no-auto-commit --model o3-mini --reasoning-effort=low"
# alias o3mini-high="source ~/git/aider/venv/bin/activate; aider --no-attribute-author --no-attribute-committer --multiline --no-gitignore --no-suggest-shell-commands --vim --watch --no-auto-commit --model o3-mini --reasoning-effort=high"

alias openai="source ~/git/aider/venv/bin/activate; aider --no-attribute-author --no-attribute-committer --multiline --no-gitignore --no-suggest-shell-commands --vim --watch --no-auto-commit --model gpt-4o"
alias openai-mini="source ~/git/aider/venv/bin/activate; aider --no-attribute-author --no-attribute-committer --multiline --no-gitignore --no-suggest-shell-commands --vim --watch --no-auto-commit --model gpt-4o-mini"

## Default
alias aider="source ~/git/aider/venv/bin/activate; aider --model claude-3-5-sonnet-20241022 --no-attribute-author --no-attribute-committer --multiline --no-gitignore --no-suggest-shell-commands --vim --watch --no-auto-commit --map-tokens=1000 --map-multiplier-no-files=1"
## GUI
alias aider-gui="source ~/git/aider/venv/bin/activate; aider --no-attribute-author --no-attribute-committer --multiline --no-gitignore --no-suggest-shell-commands --vim --watch --no-auto-commit --gui"
## Map
alias aider-map="source ~/git/aider/venv/bin/activate; aider --show-repo-map"

# ------------------------------------------------------------------------------
# Laravel Sail
alias sail='sh $([ -f sail ] && echo sail || echo vendor/bin/sail)'
alias slu='sail up -d'
alias slua='sail up'
alias slub='sail up --build'
alias sld='sail down'
alias sla='sail artisan'
alias slb='sail bash'
alias slsh='sail bash'
alias slat='sail artisan tinker'

alias slt='sail test'
alias slt='sail test -p'

alias slci='sail composer install'
alias slcl='sail composer run lint'
alias slcp='sail composer run phpstan'
alias slcf='sail composer run phpstan'

alias slni='sail npm install'
alias slnl='sail npm run lint'
alias slnl='sail npm run check'
alias slnd='sail npm run check'
# ------------------------------------------------------------------------------
# Chezmoi

## Default / Public
alias cza='cz apply'
alias czad='cz add'
alias czra='cz re-add'
alias czd='cz diff'
alias czup='cz update'
alias czps='cz git push'
czcd() {
  cd "$(cz source-path)"
}
czlg() {
  if pushd "$(cz source-path)" > /dev/null; then 
    lazygit 
    popd > /dev/null
  fi
}
## Work
alias czwa='czw apply'
alias czwad='czw add'
alias czwra='czw re-add'
alias czwd='czw diff'
alias czwup='czw update'
alias czwps='czw git push'
czwcd() {
  cd "$(cdw source-path)"
}
czwlg() {
  if pushd "$(czw source-path)" > /dev/null; then
    lazygit
    popd > /dev/null
  fi
}
## Private
alias czpa='czp apply'
alias czpad='czp add'
alias czpra='czp re-add'
alias czpd='czp diff'
alias czpup='czp update'
alias czpps='czp git push'

## All repos (work is conditional on checkout existing)
czaa() {
  cz apply && czp apply
  [ -d "$HOME/.local/share/chezmoi-work" ] && czw apply
}
czara() {
  cz re-add && czp re-add
  [ -d "$HOME/.local/share/chezmoi-work" ] && czw re-add
}
czaup() {
  cz update && czp update
  [ -d "$HOME/.local/share/chezmoi-work" ] && czw update
}
czaps() {
  cz git push && czp git push
  [ -d "$HOME/.local/share/chezmoi-work" ] && czw git push
}
czalg() {
  czlg
  czplg
  [ -d "$HOME/.local/share/chezmoi-work" ] && czwlg
}
czpcd () {
  cd "$(czp source-path)"
}
czplg() {
  if pushd "$(czp source-path)" > /dev/null; then 
    lazygit 
    popd > /dev/null
  fi
}

# ==============================================================================
# Package Management (pacman/paru)
# ==============================================================================
alias pkg-list='pacman -Qqe'                                      # List explicitly installed packages
alias pkg-list-native='pacman -Qqen'                              # List explicitly installed native (repo) packages
alias pkg-list-aur='pacman -Qqem'                                 # List explicitly installed AUR/foreign packages
alias pkg-save='mkdir -p ~/.config/pacman && pacman -Qqe > ~/.config/pacman/pkglist.txt && echo "Saved to ~/.config/pacman/pkglist.txt"'
alias pkg-install='paru -S --needed --noconfirm --skipreview - < ~/.config/pacman/pkglist.txt'
pkg-remove() {
  local pkg="$1"
  local pkglist="$HOME/.config/pacman/pkglist.txt"
  if [ -z "$pkg" ]; then
    echo "Usage: pkg-remove <package>"
    return 1
  fi
  paru -Rns "$pkg" && \
    if [ -f "$pkglist" ]; then
      sed -i "/^${pkg}$/d" "$pkglist" && echo "Removed '$pkg' from $pkglist"
    fi
}

# ==============================================================================
# Troubleshoot
# ==============================================================================
alias fix-audio='systemctl restart --user pipewire pipewire-pulse wireplumber; sudo systemctl restart bluetooth; sudo pkill -f pasystray'
alias troubleshoot-audio='journalctl --user -u pipewire -u pipewire-pulse -u wireplumber --no-pager -n 50 --since "5 minutes ago"; echo; sudo journalctl -u bluetooth --no-pager -n 50 --since "5 minutes ago"'
alias fix-bt='sudo systemctl stop bluetooth && sudo modprobe -r btusb && sudo modprobe btusb && sudo systemctl start bluetooth'
alias troubleshoot-bt='sudo journalctl -u bluetooth --no-pager -n 100 --since "10 minutes ago"; dmesg | grep -iE "btusb|bluetooth|hci" | tail -n 50'
alias fix-network='sudo systemctl restart NetworkManager'
alias troubleshoot-network='sudo journalctl -u NetworkManager'
alias fix-network-hardware='nmcli dev disconnect wlp*; nmcli dev disconnect enp*; nmcli dev connect wlp*; nmcli dev connect enp*;'

alias flush-route-cache='sudo ip neigh flush all; sudo ip route flish cache'
alias ping-local="ping -c5 192.168.0.1"
alias ping-remote="ping -c5 8.8.8.8"

# ==============================================================================
# Shadowed Command Aliases
# ==============================================================================
alias dcl="\dc"

# ==============================================================================
# Run '.bash_aliases_local' if it exists.
# ==============================================================================
if [ -f ~/.bash_aliases_local ]; then
	. ~/.bash_aliases_local
fi
